dist: xenial
language: haskell
cache:
  directories:
    - $HOME/.cabal
    - $HOME/.ghc
    - $TRAVIS_BUILD_DIR/testing/.cabal-sandbox
# Make sure to update tested-with in source/BNFC.cabal when updating these:
ghc:
  - 8.4.4
  - 8.2.2
  - 8.0.2
  - 7.10.3
  - 7.8.4
  - 7.6.3
env:
  - PACKAGEDIR="source"
  - PACKAGEDIR="testing"
matrix:
  allow_failures:
    - env: PACKAGEDIR="testing"
script:
  - if [ "$PACKAGEDIR" = source  ]; then cabal configure --enable-tests && cabal build && cabal test; fi
  - if [ "$PACKAGEDIR" = testing ]; then source scripts/env && ./scripts/bootstrap && ./scripts/runtests; fi
before_install:
  - sudo apt-get update -qq
  - sudo apt-get install alex happy
  - if [ "$PACKAGEDIR" = testing ]; then sudo apt-get install openjdk-9-jdk-headless jflex antlr4 ocaml texlive-latex-base hlint; fi
  - cd ${PACKAGEDIR}
